# RYM List to Spotify Playlist Importer

This project consists of two Python scripts designed to scrape public lists from RateYourMusic (RYM) and import the found music into a new, private Spotify playlist.

1.  **`rym-to-txt.py`**: Scrapes a given RYM list URL, extracting albums, EPs, compilations, singles, and search for linked songs (YouTube/Bandcamp) in the descriptions of each item in the list. Tries is a bit of a stretch honestly, as it is super unpredictable unless we use some sort of LLM processing for the descriptions (this doesn't). It cleans the extracted data and saves it to a structured text file. It uses a Chromium driver to bypass Cloudflare's bot protection. Well... bypass, I mean, a Chromium window will span and you have to interact with the "I'm not a robot" for it to work. Given I've done this for casual usage and fun, I just opted to make it simple.

2.  **`txt-to-spotify.py`**: Reads the text file generated by the scraper, searches Spotify for each entry, creates a private Spotify playlist in the logged in user account from the callback, and adds the found tracks. By default, it adds the most popular track for album-like entries or the specific track if found for song entries. It features API response caching and a formatted console output.

## Features

* Scrapes RateYourMusic lists, handling pagination.
* Uses `nodriver` (Chromium) to scrap data from RYM. No sandbox mode. Needs user interaction to bypass Cloudflare's bot protection.
* Identifies different release types (Album, EP, Compilation, Single).
* Extracts linked songs (YouTube, Bandcamp) when available on the RYM list. A bit of a stretch though. The algorithm is primitive. Using an LLM to analize the descriptions users write in each item of the list to find track mentions would be top notch. I don't want to handle this level of complexity for now.
* Generates a structured `.txt` file suitable for the importer script.
* Authenticates with Spotify using OAuth 2.0.
* Creates a new private Spotify playlist named after the RYM list.
* Searches Spotify for albums and songs using various strategies (exact, fuzzy matching).
* Adds tracks to the Spotify playlist (configurable number of tracks per album, default is 1).
* Implements caching for Spotify API responses (`spotify_cache.db`) to speed up subsequent runs and reduce API calls. Uses `sqlite`
* Provides formatted, colored console output indicating progress, cache hits/misses, and found/not found status.

## Requirements

* Python 3.13+
* [uv](https://github.com/astral-sh/uv) (used for running scripts and managing dependencies via script headers)
* Python packages:
    * `requests`
    * `beautifulsoup4`
    * `nodriver`
    * `spotipy`
* Spotify Developer App credentials.
* A `.env` file in the project root for Spotify credentials.

## Setup

1.  **Clone the repository:**
    ```bash
    git clone <your-repository-url>
    cd <your-repository-directory>
    ```
2.  **Install uv:**
    Follow the installation instructions on the [uv GitHub repository](https://github.com/astral-sh/uv).
3.  **Install Dependencies:**
    `uv` automatically handles the dependencies listed in the script headers when you run the scripts using `uv run`. No separate `pip install` step is usually needed if using the `uv run` command.
4.  **Create Spotify Developer App:**
    * Go to the [Spotify Developer Dashboard](https://developer.spotify.com/dashboard/).
    * Create a new application.
    * Note down the **Client ID** and **Client Secret**.
    * Edit the app settings and add a **Redirect URI**. A common one for local development is `http://127.0.0.1:8888/callback` (or `http://localhost:8888/callback`). Make sure this exact URI is registered in the Spotify app settings *and* used in your `.env` file.
5.  **Create `.env` file:**
    Create a file named `.env` in the root directory of the project and add your Spotify credentials:
    ```dotenv
    SPOTIPY_CLIENT_ID='YOUR_SPOTIFY_CLIENT_ID'
    SPOTIPY_CLIENT_SECRET='YOUR_SPOTIFY_CLIENT_SECRET'
    SPOTIPY_REDIRECT_URI='YOUR_REGISTERED_REDIRECT_URI'
    ```
    Replace the placeholder values with your actual credentials.

## Usage

The process involves two steps: scraping the RYM list, then importing it to Spotify.

**Step 1: Scrape the RYM List**

* Run the `rym_scraper.py` script using `uv run`, providing the full URL of the RYM list you want to scrape.

    ```bash
    # Example:
    uv run ./rym-to-txt.py https://rateyourmusic.com/list/M4rcus/dream-folk/
    ```
* The script will process the list (including multiple pages if necessary) and save the results into a `.txt` file in the same directory. The filename will be based on the list title and username (e.g., `Dream Folk - M4rcus.txt`).

**Step 2: Import to Spotify**

* Run the `spotify.py` script using `uv run`, providing the path to the `.txt` file generated in Step 1.

    ```bash
    # Example (if the file is in the same directory):
    uv run ./txt-to-spotify.py "Dream Folk - M4rcus.txt"
    ```

**Command-line Options for `spotify.py`:**

* `music_file`: (Required, positional argument) The path to the input `.txt` file.
* `--clear-cache`: (Optional flag) Deletes the `spotify_cache.db` file before running, forcing fresh API calls for all entries. Useful if you suspect the cache is stale or incorrect.
    ```bash
    uv run ./spotify.py --clear-cache "Your List Name - YourUsername.txt"
    ```

## Configuration

* **Spotify Credentials**: Managed via the `.env` file (see Setup).
* **Tracks per Entry**: The number of tracks added per album/EP/compilation entry can be changed by modifying the `TRACKS_PER_RELEASE` constant within the `txt-to-spotify.py` script (default is `1`).

## Input File Format (`.txt`)

The `rym-to-txt.py` script generates, and `txt-to-spotify.py` consumes, a text file with the following line formats:

```text
title: "List Title - Username"
url: "[https://rateyourmusic.com/list/](https://rateyourmusic.com/list/)..."
# Comments or blank lines are ignored by the importer

# Album-like entries:
album: "Album Name" - "Artist Name"
ep: "EP Name" - "Artist Name"
compilation: "Compilation Name" - "Artist Name"
single: "Single Name" - "Artist Name"

# Song entries (derived from YouTube/Bandcamp links):
# Tendency to fail, pray and it might work
song: "Hopefully Cleaned Song Title" - "Original Album/Release Title" - "Artist Name"